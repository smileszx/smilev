### 分库分表

#### 数据库性能瓶颈

> 连接数
> 处理能力
> 存储容量

#### 数据库优化方案

- SQL优化
- 索引
- 分区
- 主从复制，读写分离
- 缓存 ORM缓存或Redis
- 集群
- 向上扩展（扩展硬件）
- 分库分表
- 大数据

#### 切分时机

- 结合业务现状尽量不切分
- 数据量过大 阿里巴巴规约 单表理论数据存储量 500W~1000W 单表容量上线2G
- 数据增长过快
- 业务需要，对某些字段切分
- 出于安全性和可用性考虑  举例，使用腾讯云 创业公司数据丢失

#### 切分类型
- 垂直分库 
  不同数据库 业务类型切分
- 垂直分表 
  同一个库不同表 业务类型切分，用户表、商品信息、订单数据等
- 水平分表 
  同一个库，将一个表拆分，表结构一致
- 水平分库分表 
  不同库 每个库不同表

#### 数据切分引出的问题及解决方案
- 事务一致性问题 MyCat XA规范
- 跨节点的关联查询问题 join
  全局表 不做数据切片
  字段冗余 
  ER分片(订单表  订单明细表 频繁join的表放到同一个节点)
  数据组装
- 跨节点的排序，分页，函数，结果汇总二次计算
- 全局主键
  UUID 缺点无序、数据表维护、开源的全局ID生成系统 如雪花算法
- 数据迁移，扩容的问题

#### MyCat数据库分库分表中间件
当当网 sharding

http://www.mycat.io/

- 配置文件
server.xml
schema.xml
rule.xml

-如何模拟多节点场景

安装CentOS-7 -> 虚拟机克隆功能克隆多个CentOS系统 -> 各个节点安装数据库



  
  


